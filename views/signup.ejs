<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>부동산 도우미 - 회원가입 페이지</title>
  <meta name="description" content="부동산 도우미에 회원가입 하고 다양한 서비스를 이용해 보세요">
  
  <!-- 브라우저 css 기본스타일 초기화 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.2/reset.min.css">

  <!-- 제이쿼리 -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

  <!-- css 링크  -->
  <link rel="stylesheet" href="../css/main.css">
  <link rel="stylesheet" href="../css/menu.css">
  <link rel="stylesheet" href="../css/signup.css">

  <!-- JS 링크 -->
  
</head>
<body>
  <div id="container">

    <!-- Header -->
    <header>
      <%- include('menu', {user:user}) %>
    </header>

    <!-- 회원가입 -->
    <div class="signup_container">
      <form action="#">
        <div class="signup">
          <span class="title">회원가입</span>
          <hr>
      
          <label for="name">아이디</label>
          <input type="text" id="name">
      
          <label for="pw1">비밀번호</label>
          <input type="password" id="pw1">

          <label for="pw2">비밀번호 재입력</label>
          <input type="password" id="pw2">

          <label for="email">이메일주소</label>
          <input type="text" id="email" placeholder="비밀번호 분실시 사용됩니다">

          <input type="checkbox" id="terms">
          <label for="terms" class="terms_label">약관 내용에 동의합니다</label>
          <a href="/terms" class="terms_link">*약관보기</a>
          
          <br><br>
      
          <button type="button" class="signup_btn" onclick="checkSignup()">회원가입</button>
        </div>
      
        <div class="signup_link">
          <a href="/">홈으로</a>
        </div>
      </form>
    </div>
  </div>

  <!-- 회원가입버튼 클릭시 >> 휴효성검사 >> mysql저장 -->
  <script>
    function checkSignup() {

    let name = document.querySelector("#name").value;
    let pw1 = document.querySelector("#pw1").value;
    let pw2 = document.querySelector("#pw2").value;
    let email = document.querySelector("#email").value;
    let terms = document.querySelector("#terms");

    const pattern = /^[A-Za-z0-9_\.\-]+@[A-Za-z0-9\-]+\.[A-za-z0-9\-]+/;

    if (name.length < 4 || name.length >= 20) 
      alert("아이디는 4글자 ~ 20글자 이내로 입력해주세요");
    else if (pw1.length < 6)
      alert("비밀번호는 6글자 이상 입력해주세요");
    else if (pw1 != pw2)
      alert("비밀번호가 서로 일치하지 않습니다");
    else if (email == "")
      alert("이메일주소를 입력해주세요");
    else if (pattern.test(email) === false) 
      alert("이메일주소 형식이 올바르지 않습니다");
    else if (terms.checked == false) 
      alert("약관에 동의해 주세요");
    else {
      $.ajax({
        url : "/signup",
        type : "POST",
        data : {name:name, pw:pw1, email:email},
        success : function(data) {
          if(data == "아이디중복") 
            alert("이미 존재하는 아이디 입니다");
          else if(data[0] == "가입성공") {
            alert("정상적으로 회원가입 되었습니다.");
            window.location.href = '/login';
          }
        }
      })
    }
  }
  </script>
      
</body>
</html>